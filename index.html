<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Excel Data Cleaner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- SheetJS -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
:root {
    --bg-main: #f8fafc;
    --bg-card: #ffffff;
    --text-main: #1f2937;
    --text-muted: #6b7280;
    --accent: #4f46e5;
    --border: #e5e7eb;
    --drop-bg: #eef2ff;
}

body.dark {
    --bg-main: #0f172a;
    --bg-card: #020617;
    --text-main: #e5e7eb;
    --text-muted: #9ca3af;
    --accent: #818cf8;
    --border: #1e293b;
    --drop-bg: #020617;
}

* {
    box-sizing: border-box;
    font-family: "Segoe UI", system-ui, sans-serif;
}

body {
    margin: 0;
    min-height: 100vh;
    padding: 40px;
    display: flex;
    justify-content: center;
    color: var(--text-main);
    background: linear-gradient(135deg, #eef2ff, #fdf2f8, #ecfeff);
    background-size: 300% 300%;
    animation: gradientMove 12s ease infinite;
}

body.dark {
    background: linear-gradient(135deg, #020617, #0f172a, #020617);
}

@keyframes gradientMove {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

.container { max-width: 1100px; width: 100%; }

.card {
    backdrop-filter: blur(14px);
    padding: 45px;
    border-radius: 22px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.12);
    background: linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.95));
}

body.dark .card {
    background: linear-gradient(180deg, rgba(2,6,23,.85), rgba(2,6,23,.95));
}

.header { display:flex; justify-content:space-between; align-items:center; }

.toggle {
    cursor:pointer;
    padding:8px 14px;
    border-radius:999px;
    background:var(--drop-bg);
}

.tabs {
    display:flex;
    gap:12px;
    margin-top:25px;
}

.tab {
    flex:1;
    padding:12px;
    border-radius:12px;
    cursor:pointer;
    font-weight:700;
    text-align:center;
    background:var(--border);
}

.tab.active {
    background:linear-gradient(135deg,#4f46e5,#6366f1);
    color:white;
}

.drop-zone {
    margin-top: 30px;
    border: 2px dashed var(--accent);
    border-radius: 18px;
    padding: 45px;
    text-align: center;
    cursor: pointer;
}

.file-name { margin-top:10px; font-weight:600; }

input[type=file] { display:none; }

button {
    width:100%;
    margin-top:30px;
    padding:15px;
    font-size:16px;
    font-weight:700;
    border-radius:14px;
    border:none;
    background:linear-gradient(135deg,#4f46e5,#6366f1);
    color:white;
    cursor:pointer;
}

.progress-wrap { display:none; margin-top:18px; }

.progress-bar {
    height:10px;
    width:100%;
    background:var(--border);
    border-radius:999px;
    overflow:hidden;
}

.progress-bar span {
    display:block;
    height:100%;
    width:30%;
    background:linear-gradient(90deg,var(--accent),#22d3ee);
    animation:loading 1.2s infinite;
}

@keyframes loading {
    from { transform:translateX(-100%); }
    to { transform:translateX(400%); }
}

table {
    width:100%;
    border-collapse:collapse;
    margin-top:15px;
    font-size:14px;
}

th, td {
    border:1px solid var(--border);
    padding:8px;
}

th {
    background:var(--drop-bg);
    position:sticky;
    top:0;
}
</style>
</head>

<body>
<div class="container">
<div class="card">

<div class="header">
    <h2>Excel Data Cleaner</h2>
    <div class="toggle" id="themeToggle">ðŸŒ™ Dark</div>
</div>

<div class="tabs">
    <div class="tab active" id="cleanTab">ðŸ§¹ Clean Excel</div>
    <div class="tab" id="macroTab">âš™ Run Macro</div>
</div>

<div id="cleanSection">
<form id="cleanForm">
    <div class="drop-zone" id="dropZone">
        ðŸ“‚ Upload Excel / CSV
        <div class="file-name" id="fileName"></div>
    </div>
    <input type="file" id="fileInput" accept=".csv,.xls,.xlsx" required>
    <button>Clean & Preview</button>

    <div class="progress-wrap" id="progress">
        <div class="progress-bar"><span></span></div>
    </div>
</form>

<div id="previewSection" style="display:none;">
    <h4>Before Cleaning</h4>
    <div id="previewBefore"></div>

    <h4 style="margin-top:30px;">After Cleaning</h4>
    <div id="previewAfter"></div>

    <button id="downloadBtn">â¬‡ Download Cleaned Excel</button>
</div>
</div>

<div id="macroSection" style="display:none;"></div>

</div>
</div>

<script>
const API_BASE = "https://data-cleaner-backend.onrender.com";

/* DARK MODE */
themeToggle.onclick = () => document.body.classList.toggle("dark");

/* TABS */
cleanTab.onclick = () => {
    cleanTab.classList.add("active");
    macroTab.classList.remove("active");
    cleanSection.style.display = "block";
    macroSection.style.display = "none";
};

macroTab.onclick = () => {
    macroTab.classList.add("active");
    cleanTab.classList.remove("active");
    macroSection.style.display = "block";
    cleanSection.style.display = "none";
};

/* FILE UPLOAD */
dropZone.onclick = () => fileInput.click();
fileInput.onchange = () => fileName.textContent = fileInput.files[0]?.name || "";

/* TABLE RENDER */
function renderTable(data, containerId) {
    const container = document.getElementById(containerId);
    container.innerHTML = "";

    if (!data || !data.length) {
        container.innerHTML = "<p>No data</p>";
        return;
    }

    const table = document.createElement("table");
    const thead = table.createTHead();
    const headerRow = thead.insertRow();

    Object.keys(data[0]).forEach(key => {
        const th = document.createElement("th");
        th.textContent = key;
        headerRow.appendChild(th);
    });

    const tbody = table.createTBody();
    data.forEach(row => {
        const tr = tbody.insertRow();
        Object.values(row).forEach(val => {
            const td = tr.insertCell();
            td.textContent = val ?? "";
        });
    });

    container.appendChild(table);
}

/* CLEAN SUBMIT */
cleanForm.onsubmit = async e => {
    e.preventDefault();
    progress.style.display = "block";

    const fd = new FormData();
    fd.append("file", fileInput.files[0]);

    const res = await fetch(`${API_BASE}/clean`, {
        method: "POST",
        body: fd
    });

    const data = await res.json();

    renderTable(data.preview_before, "previewBefore");
    renderTable(data.preview_after, "previewAfter");

    window.cleanedData = data.preview_after;

    previewSection.style.display = "block";
    progress.style.display = "none";
};

/* DOWNLOAD XLSX */
downloadBtn.onclick = () => {
    const ws = XLSX.utils.json_to_sheet(window.cleanedData);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Cleaned Data");
    XLSX.writeFile(wb, "cleaned_excel.xlsx");
};
</script>
</body>
</html>
